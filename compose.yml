name: faucet

services:
  caddy:
    image: caddy:2.8-alpine
    depends_on:
      - php-fpm
    ports:
      - 127.0.0.1:8080:80
    restart: on-failure
    volumes:
      - ./Caddyfile-dev:/etc/caddy/Caddyfile
      - ./web:/var/www/signet-faucet/web
      - caddy_config:/config
      - caddy_data:/data

  php-fpm:
    image: 1maa/php-dev:8.3
    restart: on-failure
    volumes:
      - .:/var/www/signet-faucet
    working_dir: /var/www/signet-faucet

  redis:
    image: redis:7-alpine
    restart: on-failure
    volumes:
      - redis_data:/data

  knots:
    image: 1maa/bitcoin:v26.1.knots20240513
    ports:
      - 127.0.0.1:18443:18443
    restart: on-failure
    volumes:
      - ./knots.conf:/home/bitcoin/.bitcoin/bitcoin.conf
      - knots_data:/home/bitcoin/.bitcoin

volumes:
  caddy_config:
  caddy_data:
  knots_data:
  redis_data:
